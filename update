#!/bin/bash

cd "$(dirname "$0")"
. ./libupd

is_changed() {
  sumcmd=$(which sha256sum sha1sum md5sum cksum | head -1)
  beforesum="$($sumcmd "$0")"
  require git && git pull
  aftersum="$($sumcmd "$0")"

  [ "$beforesum" = "$aftersum" ]
}

update() {
  for ITEM in $(ls enabled/* | sort)
  do
    $ITEM --update
  done
}

echo
echo ================== Starting $(whoami)@$(hostname) ================== 
if is_changed && ! [ "$1" = "-m" -o "$1" = "--modified" ]
then
  echo ------------------ Restarting $(whoami)@$(hostname) ------------------ 
  "$0" -m
  exit
else
  update
fi
echo ================== Finished $(whoami)@$(hostname) ================== 
